"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_contact=require("./../components/contact.js"),_contact2=_interopRequireDefault(_contact),_test=require("./../mixins/test.js"),_test2=_interopRequireDefault(_test),_config=require("./../config/config.js"),_config2=_interopRequireDefault(_config),Index=function(e){function t(){var e,a,s,i;_classCallCheck(this,t);for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];return a=s=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),s.config={},s.components={contact:_contact2.default},s.mixins=[_test2.default],s.data={isHasVideo:!1,classInfo:{},navType:1,isPayed:!1,classId:8,freeClassList:[],chapterList:[],video:{src:""}},s.computed={},s.methods={navtag:function(e){this.navType=e},playVideo:function(e,t){this.isHasVideo=!0,this.freeClassList.forEach(function(e,a){e.resource.playing=a==t}),this.video.src=e.resource.media_url},gotoClassIndex:function(){wx.navigateTo({url:"/pages/class?id="+this.classId})},paytip:function(){if(this.isPayed)return void wx.navigateTo({url:"/pages/class?id="+this.classId});wx.showToast({title:"请先购买课程",icon:"success",duration:1500})},gotoPay:function(){wx.showLoading({title:"支付中..."}),_wepy2.default.request({url:_config2.default.classPay,method:"POST",data:{class_id:Number(this.classId),paysource:1},header:{cookie:"PHPSESSID="+this.$parent.globalData.sessionID}}).then(function(e){var t={},a=e.data.data;try{t=JSON.parse(a.jsapiConfig)}catch(e){console.error(e)}wx.hideLoading(),wx.requestPayment({timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:"MD5",paySign:t.paySign,success:function(e){wx.navigateTo({url:"/pages/class?id="+this.classId})},fail:function(e){}})})},gotoAircle:function(e){wx.navigateTo({url:"/pages/airticle?id="+e})}},s.events={},i=a,_possibleConstructorReturn(s,i)}return _inherits(t,e),_createClass(t,[{key:"getClassInfo",value:function(){var e=this;wx.showLoading({title:"获取中..."}),_wepy2.default.request({url:_config2.default.classInfo,method:"GET",data:{class_id:this.classId},header:{cookie:"PHPSESSID="+this.$parent.globalData.sessionID}}).then(function(t){wx.hideLoading(),e.classInfo=t.data.data,e.classInfo.price=e.formateMoney(e.classInfo.price),e.classInfo.expire_month=e.formateMonth(e.classInfo.expire_month),e.$apply(),console.log(t.data)})}},{key:"getTryList",value:function(){var e=this;_wepy2.default.request({url:_config2.default.classTry,method:"GET",data:{class_id:this.classId},header:{cookie:"PHPSESSID="+this.$parent.globalData.sessionID}}).then(function(t){var a=t.data.data;a.length&&(a.forEach(function(t){t.playing=!1,t.resource.media_time=t.resource.media_time&&e.secondsFormate(t.resource.media_time)}),e.freeClassList=a,e.$apply())})}},{key:"getChapterList",value:function(){var e=this;_wepy2.default.request({url:_config2.default.classChapter,method:"GET",data:{class_id:this.classId},header:{cookie:"PHPSESSID="+this.$parent.globalData.sessionID}}).then(function(t){var a=t.data.data;a.length&&(a.forEach(function(t,a){t.slide=0!==a,t.lesson&&t.lesson.forEach(function(t){t.resource.playing=!1,t.resource.media_time=t.resource.media_time&&e.secondsFormate(t.resource.media_time)})}),e.chapterList=a,e.$apply())})}},{key:"getIsPayed",value:function(){var e=this;_wepy2.default.request({url:_config2.default.classPay,method:"POST",data:{class_id:Number(this.classId),paysource:1},header:{cookie:"PHPSESSID="+this.$parent.globalData.sessionID}}).then(function(t){console.log(t),"您已购买此课程"==t.data.msg?e.isPayed=!0:e.isPayed=!1})}},{key:"onLoad",value:function(e){this.classId=e.id||6,this.getClassInfo(),this.getTryList(),this.getChapterList()}},{key:"onShareAppMessage",value:function(){return{title:"夜猫足彩课程",path:"/pages/index",imageUrl:"/images/share_img.jpg",success:function(e){},fail:function(e){}}}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/classPlay"));