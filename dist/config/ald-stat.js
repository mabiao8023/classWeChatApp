"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function t(t){var a="";try{a=wx.getStorageSync("aldstat_uuid")}catch(t){a="uuid-getstoragesync"}if(!a){a=""+Date.now()+Math.floor(1e7*Math.random());try{wx.setStorageSync("aldstat_uuid",a)}catch(t){wx.setStorageSync("aldstat_uuid","uuid-getstoragesync")}t.aldstat_is_first_open=!0}return a}function a(){wx.request({url:"https://"+i+".aldwx.com/config/app.json",header:{AldStat:"MiniApp-Stat"},method:"GET",success:function(t){if(200===t.statusCode)for(var a in t.data)wx.setStorageSync(a,t.data[a])}})}function s(t,a,s){if(t[a]){var e=t[a];t[a]=function(t){s.call(this,t,a),e.call(this,t)}}else t[a]=function(t){s.call(this,t,a)}}function e(t,a,s){if(t[a]){var e=t[a];t[a]=function(t){var n=e.call(this,t);return s.call(this,[t,n],a),n}}else t[a]=function(t){s.call(this,t,a)}}function n(t){this.app=t}function o(t){for(var a in t)return!1;return!0}function r(t){return"string"==typeof t&&!/[~`!@\/#+=\$%\^()&\*]+/g.test(t.replace(/\s+/g,"_"))}var _="6.1.2",i="log",l=require("./ald-stat-conf.js"),d=0,c=0,u=0,p=0,h={},g=function(t){wx.getSetting&&wx.getSetting({success:function(a){a.authSetting["scope.userInfo"]&&wx.getUserInfo({withCredentials:!1,success:function(a){t(a)}})}})},f=function(t,a,s){void 0===arguments[1]&&(a="GET"),void 0===arguments[2]&&(s="d.html");var e=0;!function n(){d+=1,t.rq_c=d,wx.request({url:"https://"+i+".aldwx.com/"+s,data:t,header:{AldStat:"MiniApp-Stat"},method:a,success:function(){},fail:function(){e<2&&(e++,t.retryTimes=e,n())}})}()},w=function(a,s,e,n){var o={ak:l.app_key,uu:t(a),at:a.aldstat_access_token,st:Date.now(),tp:e,ev:s,v:_};n&&(o.ct=n),a.aldstat_qr&&(o.qr=a.aldstat_qr),f(o,"GET","d.html")},v=function(a,s,e,n){void 0===a.aldstat_showoption&&(a.aldstat_showoption={});var o={ak:l.app_key,wsr:a.aldstat_showoption,uu:t(a),at:a.aldstat_access_token,st:Date.now(),tp:e,ev:s,nt:a.aldstat_network_type,pm:a.aldstat_phone_model,pr:a.aldstat_pixel_ratio,ww:a.aldstat_window_width,wh:a.aldstat_window_height,lang:a.aldstat_language,wv:a.aldstat_wechat_version,lat:a.aldstat_lat,lng:a.aldstat_lng,spd:a.aldstat_speed,v:_};n&&(o.ct=n),a.aldstat_location_name&&(o.ln=a.aldstat_location_name),a.aldstat_src&&(o.sr=a.aldstat_src),a.aldstat_qr&&(o.qr=a.aldstat_qr),f(o,"GET","d.html")};n.prototype.debug=function(t){v(this.app,"debug",0,t)},n.prototype.warn=function(t){v(this.app,"debug",1,t)},n.prototype.error=function(t){w(this.app,"debug",2,t)},n.prototype.sendEvent=function(t,a){if(!r(t))return!1;if(t.length>=255)return!1;if("object"===(void 0===a?"undefined":_typeof(a))){for(var s in a){if(!r(s))return!1;if("object"==_typeof(a[s]))return!1;if(!r(a[s]))return!1}v(this.app,"event",t,JSON.stringify(a))}else if("string"==typeof a&&a.length<=255){if(r(a)){var e=String(a),n=new Object;n[e]=a,v(this.app,"event",t,a)}}else v(this.app,"event",t,!1)};var y=function(){var t=this;t.aldstat_duration+=Date.now()-t.aldstat_showtime,k(t,"app","unLaunch")},S=function(t,a,s){void 0!==wx.getShareInfo?wx.getShareInfo({shareTicket:a,success:function(a){v(t,"event","ald_share_"+s,JSON.stringify(a))},fail:function(){v(t,"event","ald_share_"+s,"1")}}):v(t,"event","ald_share_"+s,"1")},m=function(s){a(),this.aldstat=new n(this);var e="";try{e=wx.getStorageSync("aldstat_src")}catch(s){e="uuid-getstoragesync"}e&&(this.aldstat_src=e);var o=t(this);this.aldstat_uuid=o,this.aldstat_timestamp=Date.now(),this.aldstat_showtime=Date.now(),this.aldstat_duration=0;var r=this;r.aldstat_error_count=0,r.aldstat_page_count=1,r.aldstat_first_page=0,this.aldstat_showoption=void 0!==s?s:{};var _=function(){wx.getSystemInfo({success:function(t){r.aldstat_vsdk_version=void 0===t.SDKVersion?"1.0.0":t.SDKVersion,r.aldstat_phone_model=t.model,r.aldstat_pixel_ratio=t.pixelRatio,r.aldstat_window_width=t.windowWidth,r.aldstat_window_height=t.windowHeight,r.aldstat_language=t.language,r.aldstat_wechat_version=t.version,r.aldstat_sv=t.system,r.aldstat_wvv=t.platform},complete:function(){l.getLocation&&d(),i()}})},i=function(){g(function(t){var a="";try{a=wx.getStorageSync("aldstat_uuid")}catch(t){a="uuid-getstoragesync"}t.userInfo.uu=a,h=t,f(t.userInfo,"GET","u.html")})},d=function(){wx.getLocation({type:"wgs84",success:function(t){r.aldstat_lat=t.latitude,r.aldstat_lng=t.longitude,r.aldstat_speed=t.speed}})};!function(){wx.getNetworkType({success:function(t){r.aldstat_network_type=t.networkType},complete:_})}();var c="";try{c=wx.getStorageSync("app_session_key_create_launch_upload")}catch(s){c=""}c?c>0&&"number"==typeof c&&(r.aldstat_access_token=""+Date.now()+Math.floor(1e7*Math.random())):r.aldstat_access_token=""+Date.now()+Math.floor(1e7*Math.random()),k(r,"app","launch")},x=function(t,a){var s=this;void 0===this.aldstat_error_count?this.aldstat_error_count=1:this.aldstat_error_count++,v(s,"event","ald_error_message",JSON.stringify(t))},k=function(a,s,e){var n="";try{n=wx.getStorageSync("app_"+e+"_upload")}catch(t){n=""}if((n||"launch"===e)&&!(n<1&&"number"==typeof n)){void 0===a.aldstat_timestamp&&(a.aldstat_timestamp=Date.now());var o=wx.getSystemInfoSync();a.aldstat_vsdk_version=void 0===o.SDKVersion?"1.0.0":o.SDKVersion,a.aldstat_phone_model=o.model,a.aldstat_pixel_ratio=o.pixelRatio,a.aldstat_window_width=o.windowWidth,a.aldstat_window_height=o.windowHeight,a.aldstat_language=o.language,a.aldstat_sv=o.system,a.aldstat_wvv=o.platform;var r={ak:l.app_key,waid:l.appid,wst:l.appsecret,uu:t(a),at:a.aldstat_access_token,wsr:a.aldstat_showoption,st:a.aldstat_timestamp,dr:a.aldstat_duration,et:Date.now(),pc:a.aldstat_page_count,fp:a.aldstat_first_page,lp:a.aldstat_last_page,life:e,ec:a.aldstat_error_count,nt:a.aldstat_network_type,pm:a.aldstat_phone_model,wsdk:a.aldstat_vsdk_version,pr:a.aldstat_pixel_ratio,ww:a.aldstat_window_width,wh:a.aldstat_window_height,lang:a.aldstat_language,wv:a.aldstat_wechat_version,lat:a.aldstat_lat,lng:a.aldstat_lng,spd:a.aldstat_speed,v:_,ev:s,sv:a.aldstat_sv,wvv:a.aldstat_wvv};"launch"===e?c+=1:"show"===e?u+=1:p+=1,r.la_c=c,r.as_c=u,r.ah_c=p,a.page_share_count&&"number"==typeof a.page_share_count&&(r.sc=a.page_share_count),a.aldstat_is_first_open&&(r.ifo="true"),a.aldstat_location_name&&(r.ln=a.aldstat_location_name),a.aldstat_src&&(r.sr=a.aldstat_src),a.aldstat_qr&&(r.qr=a.aldstat_qr),a.ald_share_src&&(r.usr=a.ald_share_src),f(r,"GET","d.html")}},b=function(t){this.aldstat_showtime=Date.now(),this.aldstat_showoption=void 0!==t?t:{};var a="";try{a=wx.getStorageSync("app_session_key_create_show_upload")}catch(t){a=""}a&&a>0&&"number"==typeof a&&(this.aldstat_access_token=""+Date.now()+Math.floor(1e7*Math.random())),k(this,"app","show"),void 0!==t&&(void 0!==t.shareTicket?S(this,t.shareTicket,"click"):void 0!==t.query&&void 0!==t.query.ald_share_src&&S(this,"0","click"))},q=function(t,a){var s=this;s.aldstat_is_first_open&&(s.aldstat_is_first_open=!1),s.aldstat_duration=Date.now()-s.aldstat_showtime,k(s,"app","hide")},D=function(t,a){var s=getApp();M(s,this,"hide")},T=function(t,a){var s=getApp();M(s,this,"unload")},A=function(t,a){var s="";try{s=wx.getStorageSync("aldstat_src")}catch(t){s=""}var e=getApp();if(wx.showShareMenu,s&&(e.aldstat_src=s),!o(t)){if(void 0!==t.aldsrc)if(s)e.aldstat_qr=t.aldsrc;else{try{wx.setStorageSync("aldstat_src",t.aldsrc)}catch(t){}e.aldstat_src=t.aldsrc,e.aldstat_qr=t.aldsrc}void 0!==t.ald_share_src&&(e.ald_share_src=t.ald_share_src),this.aldstat_page_args=JSON.stringify(t)}M(e,this,"load")},M=function(a,s,e){var n="";try{n=wx.getStorageSync("page_"+e+"_upload")}catch(t){n=""}if((n||"show"===e)&&!(n<1&&"number"==typeof n)){s.aldstat_start_time=Date.now(),s.aldstat_error_count=0,a.aldstat_page_count?a.aldstat_page_count++:a.aldstat_page_count=1,a.aldstat_first_page||(a.aldstat_first_page=s.__route__,s.aldstat_is_first_page=!0),a.aldstat_last_page=s.__route__;var o={uu:t(a),at:a.aldstat_access_token,wsr:a.aldstat_showoption,ak:l.app_key,ev:"page",st:s.aldstat_start_time,dr:Date.now()-s.aldstat_start_time,pp:s.__route__,life:e,sc:s.page_share_count,ec:s.aldstat_error_count,nt:a.aldstat_network_type,pm:a.aldstat_phone_model,pr:a.aldstat_pixel_ratio,ww:a.aldstat_window_width,wh:a.aldstat_window_height,lang:a.aldstat_language,wv:a.aldstat_wechat_version,lat:a.aldstat_lat,lng:a.aldstat_lng,spd:a.aldstat_speed,v:_,wsdk:a.aldstat_vsdk_version,sv:a.aldstat_sv,wvv:a.aldstat_wvv};s.aldstat_is_first_page&&(o.ifp="true"),a.aldstat_page_last_page&&(o.lp=a.aldstat_page_last_page),a.aldstat_location_name&&(o.ln=a.aldstat_location_name),s.aldstat_page_args&&(o.ag=s.aldstat_page_args),a.aldstat_src&&(o.sr=a.aldstat_src),a.aldstat_qr&&(o.qr=a.aldstat_qr),a.ald_share_src&&(o.usr=a.ald_share_src),a.aldstat_page_last_page=s.__route__,f(o,"GET","d.html")}},I=function(t,a){var s=getApp();M(s,this,"show")},E=function(t,a){var s=getApp();v(s,"event","ald_pulldownrefresh",1)},G=function(t,a){var s=getApp();v(s,"event","ald_reachbottom",1)},O=function(t,a){var s=this,e=getApp();if(void 0!==t&&void 0!==t[1]){var n="";try{n=wx.getStorageSync("aldstat_uuid")}catch(t){n="uuid-getstoragesync"}var o="";try{o=wx.getStorageSync(n)}catch(t){o="p_share_count_getst"}var r="";if("undefined"!==e.ald_share_src&&e.ald_share_src){r=e.ald_share_src;for(var _=r.split(","),i=!0,d=0,c=_.length;d<c;d++){if(_[d].replace('"',"")==n){i=!1;break}}_.length>=3&&(i&&_.shift(),r=_.toString()),""!==r&&i&&(r=r+","+n)}else try{r=wx.getStorageSync("aldstat_uuid")}catch(t){r="ald_share_src_getst"}if(t[1].path&&"undefined"!==t[1].path||(l.defaultPath?t[1].path=l.defaultPath:t[1].path=s.__route__),-1!=t[1].path.indexOf("?")?t[1].path+="&ald_share_src="+r:t[1].path+="?ald_share_src="+r,v(e,"event","ald_share_chain",{path:e.aldstat_last_page,chain:r}),""===o||void 0===o){try{wx.setStorageSync(n,1)}catch(t){}o=1,e.page_share_count=o}else{o=parseInt(wx.getStorageSync(n))+1,e.page_share_count=o;try{wx.setStorageSync(n,o)}catch(t){}}g(function(t){var a="";try{a=wx.getStorageSync("aldstat_uuid")}catch(t){a="uuid-getstoragesync"}t.userInfo.uu=a,f(t.userInfo,"GET","u.html")});t[1];void 0===t[1].success&&(t[1].success=function(t){}),void 0===t[1].fail&&(t[1].fail=function(t){});var u=t[1].fail,p=t[1].success;return t[1].success=function(t){new Array;if("object"===_typeof(t.shareTickets))for(var a=0;a<t.shareTickets.length;a++)S(e,t.shareTickets[a],"user");v(e,"event","ald_share_status",JSON.stringify(t)),p(t)},t[1].fail=function(t){v(e,"event","ald_share_status","fail"),u(t)},t[1]}},j=App;App=function(t){s(t,"onLaunch",m),s(t,"onUnlaunch",y),s(t,"onShow",b),s(t,"onHide",q),s(t,"onError",x),j(t)};var N=Page;Page=function(t){s(t,"onLoad",A),s(t,"onUnload",T),s(t,"onShow",I),s(t,"onHide",D),s(t,"onReachBottom",G),s(t,"onPullDownRefresh",E),void 0!==t.onShareAppMessage&&e(t,"onShareAppMessage",O),N(t)}}();